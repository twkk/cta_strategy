### 概要  
理查德·丹尼斯（Richard Dennis）作為交易員賺了超過2億美元。在與他的合夥人威廉·埃克哈特（William Eckhardt）討論了是否可以學習交易還是天生的才能之後，他們提出了一個實驗，他們將花兩週的時間對交易科學的新手進行培訓，然後分別給他們100萬美元進行投資。靈感來自丹尼斯去新加坡的一家烏龜養殖場，當時他說：“我們將像種植烏龜一樣培育貿易商。”
儘管1,000名申請人中的每一個都經過嚴格的申請程序設計，以測試他們的智力，風險管理能力和數學技能，但所選Turtles的構成差異很大。他們包括捷克斯洛伐克出生的二十一點大師，《地下城與龍》遊戲設計師，福音派會計師，哈佛大學MBA，美國空軍飛行員和前鋼琴家。四年後，海龜的總收入將超過1.5億美元。

### 交易規則：  
### 在捕獲趨勢信號時，《烏龜交易法》使用了非常重要的技術指標-唐契安通道。 該通道與熟悉的布林帶非常相似，但是在具體計算方面有所不同。
理查德·唐奇安（Richard Donchian）發明了這一指標。它由三個不同顏色的曲線組成。該指標使用一段時間內的最高價格（通常為20，某些平台系統設置可以更改，某些不能設置），而最低價格則顯示市場價格的波動性，當渠道狹窄時，表示市場波動較小，否則渠道寬度意味著市場波動較大。
當價格突破通道的上軌時，可能是買入信號；相反，當跌破較低軌道時，這可能是賣出信號。

### Donchian通道的計算方法如下：  
上軌=最大（最高，n），n天最高價格中的最高值  
下軌=最小值（最低價格，n），n天最低價格的最小值  
中軌=（上軌+下軌）/ 2  

在金融部門的多因素分析框架內，該策略基於動量因子的有效性假設來預測突破後的價格趨勢。當然，這一因素的有效性確實已經經過Fama-French三因素模型的嚴格驗證和補充，並已在金融市場中廣泛使用。
當然，我們可以優化和使用更合理的趨勢指標。
那麼，既然動量因子是已經被廣泛使用的因子，那麼為什麼《烏龜交易法》會在人群中脫穎而出呢？答案很簡單。烏龜交易規則為倉位控制和止損定義了一組非常嚴格的規則。讓我們來看看每個。

### 1.位置N的基本單位  
Turtle Rule的原理是定義一個小單位（Unit），以使頭寸的期望值波動相當於總淨資產的1％。換句話說，如果您購買此小單位的資產，則該頭寸當天的市值變化不會超過總淨資產的1％。
那麼如何定義這個小單位呢？您如何估算這個小單位可能帶來的價值波動？首先，在預測這個小單位的價值波動時（該價值波動稱為N），Turtle策略使用一種統計歷史價格波動率的方法。具體計算公式如下：
TrueRange = Max（高-低，高-PreClose，PreClose-Low）
N =（過去19天的N個值的總和+當時的TrueRange）/ 20
其中，高表示當天的最高價，低表示當天的最低價，而預收盤表示前一天的收盤價。從定義中我們可以看到，N的值確實可以正確表達資產價格的近期波動。
因此，應按以下方式計​​算單位：
單位=（1％*總淨值）/ N，Total_net是總資產淨值
可以看出，單位資產的價格波動率=淨資產總額的1％

### 2.何時開倉  
開倉的動作來自趨勢突破信號的產生。如果當前價格突破上限，它將生成買入信號。如果當前價格跌破較低軌，它將產生空頭信號（空頭交易支持加密貨幣市場！）
初始構建大小= 1個單位

### 3.什麼時候增加位置？  
如果持有頭寸是多頭頭寸，並且資產價格基於最後一個持有頭寸（或增加頭寸）上漲了0.5N，則添加一個多頭頭寸單元；  
如果持有頭寸是空頭頭寸，並且資產價格基於最後一個頭寸（或增加頭寸）下跌了0.5N，則添加一個空頭頭寸單位。
我們已經看到，海龜策略實際上是一種追逐策略。

### 4.如何做動態止損  
如果持有頭寸是多頭頭寸，並且資產價格基於最後一個持有頭寸（或增加頭寸）下跌了2N，則所有頭寸的止損；  
如果持倉為空頭，並且資產價格基於最後一個持倉（或加倉）增加了2N，則必須關閉整個持倉。  
當然，用戶可以自定義動態止損計劃，例如下跌0.5N以開始部分平倉，而不是在急於平倉之後等待2N下跌；畢竟，影響成本在那裡。  

### 5.如何獲利，您可以自定義動態獲利嗎？  
在海龜規則中，“獲利”信號生成如下：  
如果持有頭寸為多頭頭寸，並且當前資產價格低於第十個Donchian通道的下軌，則所有頭寸均平倉；
如果持有頭寸為空頭頭寸，並且當前資產價格上漲至第十個Donchian通道的上方軌道上方，則所有頭寸均關閉。
當然，用戶可以自定義動態獲利計劃，例如當總淨資產/初始淨資產> 1.5時，僅獲利。

### 優點《海龜交易法》的最大優勢是幫助我們建立了控制頭寸規模的有效方法。  
壞處 烏龜交易系統的趨勢跟踪策略存在一個普遍問題，那就是浮動利潤的提取。追逐的浮動利潤可能由於突然下跌而被吐出。它在大趨勢中非常強勁，並且在震盪市場中表現不佳。


https://medium.com/@FMZ_Quant/m-language-turtle-trading-strategy-implementations-1637cfc513d6
聊夠了，讓我們實現它！  
M語言  
經過6年的發展，它吸收了成千上萬用戶的反饋。這是一個成熟穩定的模型開發平台。M語言是中國使用最廣泛的程序模型開發平台。
M語言提倡構建塊編程的概念，該概念將復雜的算法封裝到各個函數中，並採用“小語法，大函數”的構建模式。儘管語法很簡單，但是它還可以通過特殊的程序化數據結構和豐富的金融統計功能庫來支持邏輯和復雜的金融應用程序。
M語言的功能庫經常更新，並且可以根據客戶的新要求隨時添加新功能，以支持程序員的新思想和新應用。
FMZ Quant不僅實現了M語言語法的解釋器，而且增強了其將編程與高級語言（例如JavaScript）混合的能力。
